version: '3.9'

services:
  server:
    image: node:22-alpine
    working_dir: /app/server
    volumes:
      - ./server:/app/server
      - /app/server/node_modules
    command: >
      sh -c "corepack enable
      && corepack prepare pnpm@10.28.2 --activate
      && pnpm install
      && pnpm dev"
    ports:
      - '3000:3000'

  client:
    image: node:22-alpine
    working_dir: /app/client
    volumes:
      - ./client:/app/client
      - /app/client/node_modules
    command: >
      sh -c "corepack enable
      && corepack prepare pnpm@10.28.2 --activate
      && pnpm install
      && pnpm exec vite --host 0.0.0.0 --port 5173"
    environment:
      VITE_SOCKET_URL: http://localhost:3000
    ports:
      - '5173:5173'
    depends_on:
      - server
